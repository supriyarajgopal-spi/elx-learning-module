<?php

//require_once 'includes/password.inc';
//require_once 'sites/all/modules/contrib/aes/aes.module';
//require_once 'includes/database/prefetch.inc';


function elx_utility_node_validate($node, $form, &$form_state) {
  // dpm($node);
  // if ($node->type=='history' || $node->type=='teaser') {
  //   if (strlen($node->field_link['und'][0]['url']) && $node->field_video_upload['und'][0]['fid']) {
  //     form_set_error('field', t('You may either use a link or a video, not both.'));
  //   }
  //   elseif (!(strlen($node->field_link['und'][0]['url']) || $node->field_video_upload['und'][0]['fid'])) {
  //     form_set_error('field', t('You must choose either a link or a video (but not both).'));
  //   }
  // }
}


/**
 * Implements hook_preprocess_html.
 */
function elx_utility_preprocess_html(&$variables) {
// Add conditional stylesheets for admin pages on admin theme.
  global $user;
  if ($user->uid) {
    // reference your current admin theme
    $theme_path = drupal_get_path('theme', 'seven');
    // reference your own stylesheet
    drupal_add_css(drupal_get_path('module', 'elx_utility')
    . '/admin.css', array('weight' => CSS_THEME));
    drupal_add_js(drupal_get_path('module', 'elx_utility')
    . '/admin.js');
    drupal_add_js(drupal_get_path('module', 'elx_utility')
    . '/jquery.alphanum.js');
    
  }
}

/**
 * Random pass generator.
 */
function randomPassword() {
  $alphabet = "abcdefghijkmnopqrstuwxyzABCDEFGHJKMNPQRSTUWXYZ23456789";
  $pass = array(); //remember to declare $pass as an array
  $alphaLength = strlen($alphabet) - 1; //put the length -1 in cache
  for ($i = 0; $i < 8; $i++) {
    $n = rand(0, $alphaLength);
    $pass[] = $alphabet[$n];
  }
  return implode($pass); //turn the array into a string
}

/**
 * Implements hook_feeds_after_save().
 * Auto-generate user password on user feed import
 */
function elx_utility_feeds_after_save(FeedsSource $source, $entity, $item, $entity_id) {
  if (isset($entity->pass) && $entity->pass == '') {
    require_once DRUPAL_ROOT . '/' . variable_get('password_inc', 'includes/password.inc');
    $password = randomPassword();
    $encrypted_data = aes_encrypt($password);
    watchdog('elx_utility_feeds_after_save', 'New user ' . $entity->uid . ' new password.');
    $entity->pass = $password;
    db_insert('aes_passwords')
      ->fields(array(
        'uid' => $entity->uid,
        'pass' => $encrypted_data,
      ))
      ->execute();
    $pass = user_hash_password($password);
    db_update('users')
      ->fields(array('pass' => $pass))
      ->where("uid = :uid", array(
        ':uid' => $entity->uid,
      ))
      ->execute();
    $account = user_load($entity->uid);
    drupal_mail('user', 'register_admin_created', $account->mail, $entity->language, array('account' => $account), variable_get('site_mail', 'noreply-myelx@estee.com'));
  }
}

/**
 * Implements hook_clone_node_alter().
 */
function elx_utility_clone_node_alter(&$node, $context) {
  $lang = $node->language;
  // Empty manifest reference
  if (isset($node->field_manifest[$lang][0]['target_id'])) {
    $node->field_manifest[$lang][0]['target_id'] = '';
  }
}

/**
 * Implements hook_feeds_after_parse().
 */
function elx_utility_feeds_after_parse(FeedsSource $source, FeedsParserResult $result) {
  // add space to all field_keys for data_xls import
  // some field_keys have spaces after parsing and can't alter mapping directly
  if ($source->importer->id == 'data_xls') {
    foreach ($result->items as $item_key => $item) {
      foreach($item as $field_key => $field_val) {
        $result->items[$item_key][$field_key . ' '] = $field_val;
      }
    }
  }
}

/**
 * Implements hook_entity_info_alter().
 * Created by SUPRIYA RAJGOPAL on 21Jul16 to create a view mode for nodes so that they can be displayed in a modal using Ctools modal
 * Borrowed from http://www.wunderkraut.com/blog/drupal-7-custom-node-view-modes/2010-12-20
 */
function elx_utility_entity_info_alter(&$entity_info)
{
  $entity_info['node']['view modes']['modal'] = array(
    'label' => t('Modal'),
    'custom settings' => TRUE,
  );
}

/**
 * Implements hook_menu().
 * Created by SUPRIYA RAJGOPAL on 21Jul16 to define a path which renders product details in a modal
 * !Note: The click to this path should be AJAX enabled by adding 'use-ajax' class
 * Borrowed from https://www.drupion.com/blog/10-steps-creating-ctools-modal-window-drupal-7
 */
function elx_utility_menu()
{
  $items['modal/%ctools_js/%'] = array(
      'title' => 'ELX Custom Modal',
      'page arguments' => array(1,2), //Pass whether to use AJAX or JS and the nid
      'page callback' => '_elx_custom_modal', //User defined function called when the link is clicked
      'access callback' => TRUE,
      'type' => MENU_NORMAL_ITEM, //Internal path menu, not a menu tab
  );
 
  $items['modal/%ctools_js/flags/%'] = array(
      'title' => 'Product Details Modal',
      'page arguments' => array(1,3), //Pass whether to use AJAX or JS and the machine name of the flag
      'page callback' => '_elx_badges_modal', //User defined function called when the link is clicked
      'access callback' => TRUE,
      'type' => MENU_NORMAL_ITEM, //Internal path menu, not a menu tab
  );
  
  /*Included by SUPRIYA RAJGOPAL on 4Oct16 to define a page when site is not accessible for certain users*/
  $items['noaccess'] = array(
      'title' => 'Site not accessible',
      'page callback' => '_noaccess',
      'access callback' => '_userNotBelongsToSpecificMarkets',
      'type' => MENU_NORMAL_ITEM, //Internal path menu, not a menu tab
	  'theme callback' => 'noaccess'
  );
  return $items;
}

function _elx_custom_modal($js = NULL, $nid = NULL)
{
  if($nid == NULL)
   return 'No content to display.';
 
  //Include ctools if path contains 'nojs' to work, else render page normally
  if($js)
  {
    ctools_include('modal');
    ctools_include('ajax');
	  ctools_modal_add_js(); //Default CTools JS. This is a must if custom javascript is not available.
    drupal_add_js(array(
        'elx-tools' => array(
          'modalSize' => array(
            'type' => 'scale',
            'width' => .6,
            'height' => .8,
            'contentRight' => 5,
            'contentBottom' => 20,
          ),
          'animation' => 'slideDown',
          'closeText' => t(''),
          'closeImage' => t(''),
          //'closeImage' => base_path() . path_to_theme() . '',
        ),
      ), 'setting');
      
    drupal_add_js(array(
        'product-library' => array(
          'modalSize' => array(
            'type' => 'scale',
            'width' => 1,
            'height' => 1,
            'contentRight' => 5,
            'contentBottom' => 20,
          ),
          'animation' => 'slideDown',
          'closeText' => t(''),
          'closeImage' => t(''),
          //'closeImage' => base_path() . path_to_theme() . '',
        ),
      ), 'setting');
      
    drupal_add_js(array(
        'search-product-library' => array(
          'modalSize' => array(
            'type' => 'scale',
            'width' => 1,
            'height' => 1,
            'contentRight' => 5,
            'contentBottom' => 20,
          ),
          'animation' => 'slideDown',
          'closeText' => t(''),
          'closeImage' => t(''),
          //'closeImage' => base_path() . path_to_theme() . '',
        ),
      ), 'setting');

      drupal_add_js(array(
          'levels' => array(
            'modalSize' => array(
              'type' => 'scale',
              'width' => 1,
              'height' => 1,
              'addHeight' => 80, // this needs to match the css height for div.modal-header or it acts buggy
              'contentRight' => 5,
              'contentBottom' => 0,
            ),
            'modalClass' => 'default',
            'animation' => 'slideDown',
            'closeText' => t(''),
            'closeImage' => t(''),
            //'closeImage' => base_path() . path_to_theme() . '',
          ),
        ), 'setting');
    
  }
  
  //Load the node object
  $node = node_load($nid);
  
  //Render content in 'Modal' view mode
  $nodeContent = node_view($node, 'modal', NULL); //To prevent strict warning that only variables can be passed by reference
  $contents = render($nodeContent);
  $integration = h5p_add_files_and_settings(NULL, NULL);
  if ($integration) {
    drupal_add_js(array('H5PIntegration' => $integration), 'setting');
  }
  return ctools_modal_render($node->title, $contents) ;
}

/**
 * User defined page callback created by SUPRIYA RAJGOPAL on 2Aug16 to show badge title in a modal
 * Borrowed from https://www.drupion.com/blog/10-steps-creating-ctools-modal-window-drupal-7
 *
 * @param $js
 *   boolean CTools determination whether the user's browser is javascript enabled. 
 * @param $flag_name
 *   string The machine name of flag passed as an argument from the hook_menu() path
 * @return
 *   string The flag title in a modal window
 */
function _elx_badges_modal($js = NULL, $flag_name = NULL)
{
  global $user;
  if($flag_name == NULL)
   return 'No content to display.';
   
  //Include ctools iff path contains 'nojs' to work, else render page normally
  if($js)
  {
    ctools_include('modal');
    ctools_include('ajax');
	ctools_modal_add_js(); //Default CTools JS. This is a must if custom javascript is not available.
  }
  
  $flag = flag_load($flag_name); //Load the flag object
  $is_flagged = $flag->is_flagged($user->uid);//is the current user flagged?
  
  //Form the modal content
  $rendered_title = (isset($flag->title) && $flag->title != '')?$flag->title:'';
  $rendered_description = (isset($flag->badge_description) && $flag->badge_description != '')?$flag->badge_description:'';
  $rendered_undescription = (isset($flag->badge_unearned_description) && $flag->badge_unearned_description != '')?$flag->badge_unearned_description:'';
  //$image = (isset($flag->badge_image) && $flag->badge_image != 0)?file_load($flag->badge_image):FALSE;
  //$rendered_img = ($image)?'Image: '.render(theme_image_style(array('style_name' => 'thumbnail','path' => $image->uri))):'';

  if ($is_flagged) {
    $output = $rendered_description;
  } else {
    $output = $rendered_undescription;
  }

  return ctools_modal_render($rendered_title.":".$output,$output); //Render content in 'Modal' view mode
  //return ctools_modal_render($flag->title,$output); //Render content in 'Modal' view mode
}

/**
 * Implements hook_menu_link_alter()
 * Included by SUPRIYA RAJGOPAL on 4Oct16
 * Borrowed from https://api.drupal.org/comment/45108#comment-45108
 */
function elx_utility_menu_link_alter(&$item)
{
	if($item['link_path']=="user" && user_is_anonymous()) //If the path is '/user' but user is not logged in, redirect to user/login
	{
		$item['link_path'] = 'user/login';
	}
}

/**
 * Implements hook_user_login().
 * Created by SUPRIYA RAJGOPAL on 4Oct16 to logout a user if s/he does not belong to a specific set of markets
 */
function elx_utility_user_login(&$edit,$account)
{
	if(_userNotBelongsToSpecificMarkets())
		drupal_goto('noaccess');
}

/**
 * Helper function that checks if logged in user belongs to the mentioned markets
 * Returns FALSE if user belongs to atleast one of the markets mentioned in the function; TRUE otherwise
 */
function _userNotBelongsToSpecificMarkets()
{
	//Load the markets - Fashion Group,South Africa,U.K.,Singapore,Canada,New Zealand,Australia,United States in that order
	$markets = array(34466,34476,34489,34498,34506,34518,34519,34520);
	$isMember = false; //Flag to check if user belongs to any of the above markets
	foreach($markets as $market)
	{
		if(og_is_member('node', $market, 'user'))
		{
			$isMember = true;
			break;
		}
	}
	return !$isMember;
}

/**
 * Page callback of 'noaccess' page
 * Print the site-not-accessible message and log the user out
 */
function _noaccess()
{
	global $user;
	return theme('noaccess', array('title' => 'Site not accessible','errorMsg' => errorMsg($user->language)));
	user_logout();
}

/**
 * Implements hook_theme();
 */
function elx_utility_theme($existing, $type, $theme, $path)
{
    return array(
        'noaccess' => array(
            'variables' => array('title' => NULL,'errorMsg' => ''),
            'template' => 'noaccess',
        ),
    );
}

/**
 * Helper function that returns the 'site not accessible' message in the desired language
 * Borrowed from https://github.com/MasterDoublePrime/elx-varnish/blob/master/var/www/errors/503_coming_soon.html
 */
function errorMsg($language)
{
  $langError = '';
  
  // [mo] for Moldavian has been withdrawn, recommending [ro] also for Moldavian
  if ($language === 'mo') {
    $language = 'ro';
  }
  // nn and no also Norwegian
  if ($language === 'nn' || $language === 'no') {
    $language = 'nb';
  }
  // Chinese -> Traditional Chinese (FF only sends 'zh').
  if ($language === 'zh') {
    $language = 'zh-Hant';
  }
  // zh-CN is much more common code for Simplified Chinese.
  if ($language === 'zh-CN') {
    $language = 'zh-Hans';
  }
  // zh-TW is much more common code for Traditional Chinese.
  if ($language == 'zh-TW') {
    $language = 'zh-Hant';
  }
  // Default to english.
  if (!$language) {
    $language = 'en';
  }
  //Spanish     
  if ($language === 'es') {
  	$langError = '¡ELX está en mantenimiento en este momento, haciendo una serie de mejoras en el sistema. Por favor regresa el 10 de octobre de 2016 para experimentar mejoras emocionantes y nuevas características. También encontrarás nuevo contenido para aprender. No te lo pierdas. Te vemos pronto!';
  }
  //Romanian     
  else if ($language === 'ro') {
  	$langError = 'ELX este in prezent in modul de intretinere. Te rugam sa verifici din nou in curand - ne cerem scuze pentru orice inconvenient.';
  }
  //Turkish     
  else if ($language === 'tr') {
  	$langError = 'ELX , yüklenecek yeni içerikler nedeniyle su an bakim çalismasindadir. ELX’in  yepyeni ve heyecan verici yüzüyle ve özellikleriyle tanismak için sizi, 10/10/2016 tarihinde, ELX’e giris yapmaya davet ediyoruz. Yeni lansmanlarimiz ve içeriklerine de ulasabileceginiz bu muhtesem deneyimi sakin kaçirmayin. Görüsmek üzere.';
  }
  //Hungarian     
  else if ($language === 'hu') {
  	$langError = 'Az ELX jelenleg karbantartás alatt áll a frissítések feltöltése céljából. Látogass vissza az oldalra : 10/10/2016 (hónap/nap/év) –tól és fedezd fel az újdonságokat, fejlesztéseket, legfrisebb tartalmakat. Ne maradj le! Visszavárunk!';
  }
  //Russian     
  else if ($language === 'ru') {
  	$langError = '????????? ???????? ??????????, ??? ??? ??????????? ??? ??????????. ?? ??????? ????????? ? ELX ????? 10.10.2016, ????? ?????? ?? ?????????? ? ?????????? ??????? ?????????. ??? ?? ????? ???????? ??? ???????? ????? ???????. ?? ??????????! ?? ????? ??????!';
  }
  //Latvian     
  else if ($language === 'lv') {
  	$langError = "ELX pašlaik tiek veikta apkope, vietnes atjauninajumiem. Ludzu, dodieties 10/10/2016 (dd / mm / gggg), jus redzesiet mazliet jauna pieredze uzlabotu sistemu un jaunas funkcijas. Mes ari tureseme jaunu saturu pieejami, lai jus varetu macities. Nepalaidiet garam. Uz \ndrizu tikšanos!";
  }
  //Lithuanian     
  else if ($language === 'lt') {
  	$langError = 'Elx šiuo metu vyksta technines prieiuros darbai   ,  svetaines atnaujinimai. Prašome griti   10/10/2016 (DD / MM / YYYY) pamatysite šiek tiek naujos patirties patobulinta sistema ir naujos funkcijos. Mes taip pat tureseme nauja turini prieinami jums išmokti. Nepraleiskite. Iki greito pasimatymo!';
  }
  //Finnish     
  else if ($language === 'fi') {
  	$langError = "ELX on tällä hetkellä huollossa,  huollon jälkeen luvassa useita parannuksia ja sisältöä sivustolle . Tervetuloa takaisin 10.10.2016. \nMeillä on myös siinä vaiheessa uutta materiaalia opittavaksi. Älä missaa uutuuksia. Nähdään pian!";
  }
  //Polish     
  else if ($language === 'pl') {
  	$langError = 'Trwa przerwa techniczna na stronie ELX w celu poprawienia jej jakosci. Zapraszamy ponownie 10/10/2016 (mm/dd/rrrr) do odkrywania lepszego serwisu i nowych funkcji. Powrócimy równiez z nowymi informacjami do czytania. Nie przegap nowosci! Do zobaczenia wkrótce!';
  }
  //Norwegian     
  else if ($language === 'nb') {
  	$langError = 'ELX er fortiden i en oppgraderingsfase, og gjennomfører en mengde oppgraderinger. Vennligst kom tilbake 10/10/2016 (mm/dd/yyyy) for å oppleve spennende system forbedringer og nye opplevelser. Vi vil også ha nytt innhold tilgjengelig for deg slik at du kan lære enda mer. Ikke gå glipp av dette. Vi sees snart!';
  }
  //Swedish     
  else if ($language === 'sv') {
  	$langError = 'ELX är utför just nu en rad olika uppdateringar på webbplatsen. Vänligen återkom 2016/10/10 (mm / dd / åååå) för att uppleva några spännande systemförbättringar och nya funktioner. Vi kommer också att lansera ett helt nytt innehåll som blir tillgängligt för dig så att du kan lära dig ännu mer. Missa det inte. Vi ses snart!';
  }
  //Danish     
  else if ($language === 'da') {
  	$langError = 'ELX er lige nu under opdatering. Kom venligst tilbage d. 10/10/2016 for at opleve nogle spændende systemforbedringer og nye funktioner. Der vil også være helt nyt indhold tilgængeligt så du kan lære endnu mere. Gå ikke glip af det. Vi ses snart!';
  }
  //Arabic     
  else if ($language === 'ar') {
  	$langError = 'ELX ????? ?? ??? ??????? ? ???? ????? ?? ?????????? ??????. ???? ?????? ?? 10/10/2016 ?????? ??? ????????? ??????? ?????? ? ??????? ???????. ????? ????? ????? ???? ???? ?? ?????? ?????. ?? ???? ??????. ??? ???? ?????!';
  }
  //Italian     
  else if ($language === 'it') {
  	$langError = 'ELX è in fase di aggiornamento. Ritorna su ELX il 10/10/2016 per scoprire miglioramenti e nuove funzionalità. Ci saranno anche nuovi contenuti e aggiornamenti. Non mancare ti aspettiamo presto su ELX!';
  }
  //Hebrew
  else if ($language === 'he') {
    $langError = 'ELX ???? ???? ??? ??? ????? ???? ??????? ????. ??? ???? ????? ?????? 10/10/2016 ??? ??????? ?????? ??????, ???????? ????? ????? ?????? ???. ?? ??????. ????? ?????!';
  }
  //Greek     
  else if ($language === 'el') {
  	$langError = "?? ?LX ß??s?eta? ?p? s??t???s?, ?a??? d?e?e?????ta? e??as?e? a?aß??µ?s?? st?? ?st?se??da.\n\n?p??e?te ?a epa????ete st?? ?st?se??da st?? 10/10/2016 ??a ?a ??sete t? s??a?past??? eµpe???a t?? e??????? t?? s?st?µat??, µe ta ??a t?? ?a?a?t???st???. ?p?s?? ?a ????µe st? d???es? sa? ??e? p????f???e? ?a? pe??e??µe?a ??a ?a d?e????ete t?? ???se?? sa?. ??? ?e??sete ?a µa? ep?s?ef?e?te. Ta e?µaste s??t?µa ???t? sa? !";
  }
  //German     
  else if ($language === 'de') {
  	$langError = "ELX wird momentan für Euch bearbeitet. \nAb 10.10.2016 begrüßen wir Euch wieder mit viel Neuem! Lasst Euch überraschen und freut Euch auf die attraktiven Inhalte. \nBitte notiert Euch im Kalender, dass Ihr Euch am 15.09. wieder einloggt.  Bis dahin!";
  }
  //Czech     
  else if ($language === 'cs') {
  	$langError = 'ELX je v soucasné dobe v reimu údrby. Provádíme aktualizaci. Prosím vratte se na stránky 10.10. 2016 a objevujte mnoho novıch vylepšení a funkcí. Tešit se muete i na novı obsah. Nenechte se to ujít. Brzy na shledanou!';
  }
  //Dutch     
  else if ($language === 'nl') {
  	$langError = 'Wegens onderhoudswerkzaamheden is de ELX-website tijdelijk niet beschikbaar. We verwelkomen je graag terug op 10 october 2016 met enkele systeemverbeteringen en nieuwe toepassingen. Je zal ook nieuwe inhoud kunnen ontdekken die je niet mag missen. Graag tot snel!';
  }
  //Thai     
  else if ($language === 'th') {
  	$langError = "?????? ELX ?????????????????? ????????????????????????????????????????????????????????? ????????????????????????????????????? ?????? 10 ?????? 2016 ?????????\": \"???????????????????????????????????????????????????????????? ????????????????????????????????????????????????????????????????? ??????????????????? !";
  } 
  //Korean     
  else if ($language === 'ko') {
  	$langError = "??, ELX ???? ??? ????? ?? ??? ?????. \n??? ???? ?? ????? ?????? ELX ????2016? 10? 10??? ??? ??? ????.";
  }
  //Japanese     
  else if ($language === 'ja') {
  	$langError = "ELX?????????????????????????\n2016?10?10????????????????????????????????\n??????????????????????????????????";
  }
  //Indonesian     
  else if ($language === 'id') {
  	$langError = 'Saat ini ELX masih dalam tahap perbaikan untuk menjalankan beberapa peningkatan pada situs. Harap kembali pada 10/10/2016 (mm/dd/yyyy) untuk mencoba fitur-fitur baru dan beberapa perbaikan sistem yang menarik. Kami juga memiliki konten baru yang bisa Anda pelajari. Jangan lewatkan. Sampai jumpa!';
  }
  //Simplified Chinese     
  else if ($language === 'zh-Hans') {
  	$langError = "ELX????????,?????????????2016?10?10?????,??????????????????????\n???????????????,????????,????!";
  }
  //Traditional Chinese     
  else if ($language === 'zh-Hant') {
  	$langError = 'ELX???????,?? 10/10/2016 ???????????????????????,??????!';
  }
  //French
  else if ($language === 'fr') {
    $langError = 'Le site ELX est en cours de maintenance. Merci de vous reconnecter le 10/10/2016 afin de découvrir les nouvelles fonctionnalités de votre site d’apprentissage Estée Lauder.  Vous y découvrirez également beaucoup de nouveautés à ne pas manquer ! A très bientôt !';
  }
  //French(Canada)
  else if ($language === 'fr-CA') {
  	$langError = "ELX est présentement en entretien et effectue des mises à niveau pour l'amélioration de ce site. S’il-vous-plaît, revenez nous visiter le 10/10/2016 (mm/jj/aaaa) et expérimentez un système perfectionné ainsi que de nouvelles fonctionnalités. Nous aurons également du nouveau contenu à votre disposition. Ne manquez rien. Nous vous reverrons bientôt!";
  }
  //Default to English
  else {
    $langError = 'ELX is currently in maintenance mode, performing a series of upgrades for the site.  Please come back on 10/10/2016 to experience some exciting system improvements and new features. We will also have new content available for you to learn. Don’t miss out. We will see you soon!';
  }
  return $langError;
}
function elx_utility_init()
{
	global $user;
	if(user_is_logged_in() && _userNotBelongsToSpecificMarkets())
	{
		drupal_set_message(t('@errorMsg',array('@errorMsg' => errorMsg($user->language))));
		drupal_access_denied();
		module_invoke_all('exit');
		drupal_exit();
	}
}

/**
 * Helper function that returns the 'site not accessible' message in the desired language
 * Borrowed from https://github.com/MasterDoublePrime/elx-varnish/blob/master/var/www/errors/503_coming_soon.html
 */
function errorMsg($language)
{
  $langError = '';
  
  // [mo] for Moldavian has been withdrawn, recommending [ro] also for Moldavian
  if ($language === 'mo') {
    $language = 'ro';
  }
  // nn and no also Norwegian
  if ($language === 'nn' || $language === 'no') {
    $language = 'nb';
  }
  // Chinese -> Traditional Chinese (FF only sends 'zh').
  if ($language === 'zh') {
    $language = 'zh-Hant';
  }
  // zh-CN is much more common code for Simplified Chinese.
  if ($language === 'zh-CN') {
    $language = 'zh-Hans';
  }
  // zh-TW is much more common code for Traditional Chinese.
  if ($language == 'zh-TW') {
    $language = 'zh-Hant';
  }
  // Default to english.
  if (!$language) {
    $language = 'en';
  }
  //Spanish     
  if ($language === 'es') {
  	$langError = 'Â¡ELX estÃ¡ en mantenimiento en este momento, haciendo una serie de mejoras en el sistema. Por favor regresa el 10 de octobre de 2016 para experimentar mejoras emocionantes y nuevas caracterÃ­sticas. TambiÃ©n encontrarÃ¡s nuevo contenido para aprender. No te lo pierdas. Te vemos pronto!';
  }
  //Romanian     
  else if ($language === 'ro') {
  	$langError = 'ELX este in prezent in modul de intretinere. Te rugam sa verifici din nou in curand - ne cerem scuze pentru orice inconvenient.';
  }
  //Turkish     
  else if ($language === 'tr') {
  	$langError = 'ELX , yÃ¼klenecek yeni iÃ§erikler nedeniyle ÅŸu an bakÄ±m Ã§alÄ±ÅŸmasÄ±ndadÄ±r. ELXâ€™in  yepyeni ve heyecan verici yÃ¼zÃ¼yle ve Ã¶zellikleriyle tanÄ±ÅŸmak iÃ§in sizi, 10/10/2016 tarihinde, ELXâ€™e giriÅŸ yapmaya davet ediyoruz. Yeni lansmanlarÄ±mÄ±z ve iÃ§eriklerine de ulaÅŸabileceÄŸiniz bu muhteÅŸem deneyimi sakÄ±n kaÃ§Ä±rmayÄ±n. GÃ¶rÃ¼ÅŸmek Ã¼zere.';
  }
  //Hungarian     
  else if ($language === 'hu') {
  	$langError = 'Az ELX jelenleg karbantartÃ¡s alatt Ã¡ll a frissÃ­tÃ©sek feltÃ¶ltÃ©se cÃ©ljÃ¡bÃ³l. LÃ¡togass vissza az oldalra : 10/10/2016 (hÃ³nap/nap/Ã©v) â€“tÃ³l Ã©s fedezd fel az ÃºjdonsÃ¡gokat, fejlesztÃ©seket, legfrisebb tartalmakat. Ne maradj le! VisszavÃ¡runk!';
  }
  //Russian     
  else if ($language === 'ru') {
  	$langError = 'ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ñ€ÑĞ´ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹. Ğ’Ñ‹ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ² ELX Ğ¿Ğ¾ÑĞ»Ğµ 10.10.2016, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ Ğ¾Ğ± Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… Ğ¸ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸ÑÑ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹. Ğ¢Ğ°Ğº Ğ¶Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚. ĞĞµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ! Ğ”Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²ÑÑ‚Ñ€ĞµÑ‡!';
  }
  //Latvian     
  else if ($language === 'lv') {
  	$langError = "ELX paÅ¡laik tiek veikta apkope, vietnes atjauninÄjumiem. LÅ«dzu, dodieties 10/10/2016 (dd / mm / gggg), jÅ«s redzÄ“siet mazliet jauna pieredze uzlabotu sistÄ“mu un jaunas funkcijas. MÄ“s arÄ« turÄ—seme jaunu saturu pieejami, lai jÅ«s varÄ“tu mÄcÄ«ties. Nepalaidiet garÄm. Uz \ndrÄ«zu tikÅ¡anos!";
  }
  //Lithuanian     
  else if ($language === 'lt') {
  	$langError = 'Elx Å¡iuo metu vyksta techninÄ—s prieÅ¾iÅ«ros darbai   ,  svetaines atnaujinimai. PraÅ¡ome grÄ¯Å¾ti   10/10/2016 (DD / MM / YYYY) pamatysite Å¡iek tiek naujos patirties patobulinta sistema ir naujos funkcijos. Mes taip pat turÄ—seme naujÄ… turinÄ¯ prieinami jums iÅ¡mokti. Nepraleiskite. Iki greito pasimatymo!';
  }
  //Finnish     
  else if ($language === 'fi') {
  	$langError = "ELX on tÃ¤llÃ¤ hetkellÃ¤ huollossa,  huollon jÃ¤lkeen luvassa useita parannuksia ja sisÃ¤ltÃ¶Ã¤ sivustolle . Tervetuloa takaisin 10.10.2016. \nMeillÃ¤ on myÃ¶s siinÃ¤ vaiheessa uutta materiaalia opittavaksi. Ã„lÃ¤ missaa uutuuksia. NÃ¤hdÃ¤Ã¤n pian!";
  }
  //Polish     
  else if ($language === 'pl') {
  	$langError = 'Trwa przerwa techniczna na stronie ELX w celu poprawienia jej jakoÅ›ci. Zapraszamy ponownie 10/10/2016 (mm/dd/rrrr) do odkrywania lepszego serwisu i nowych funkcji. PowrÃ³cimy rÃ³wnieÅ¼ z nowymi informacjami do czytania. Nie przegap nowoÅ›ci! Do zobaczenia wkrÃ³tce!';
  }
  //Norwegian     
  else if ($language === 'nb') {
  	$langError = 'ELX er fortiden i en oppgraderingsfase, og gjennomfÃ¸rer en mengde oppgraderinger. Vennligst kom tilbake 10/10/2016 (mm/dd/yyyy) for Ã¥ oppleve spennende system forbedringer og nye opplevelser. Vi vil ogsÃ¥ ha nytt innhold tilgjengelig for deg slik at du kan lÃ¦re enda mer. Ikke gÃ¥ glipp av dette. Vi sees snart!';
  }
  //Swedish     
  else if ($language === 'sv') {
  	$langError = 'ELX Ã¤r utfÃ¶r just nu en rad olika uppdateringar pÃ¥ webbplatsen. VÃ¤nligen Ã¥terkom 2016/10/10 (mm / dd / Ã¥Ã¥Ã¥Ã¥) fÃ¶r att uppleva nÃ¥gra spÃ¤nnande systemfÃ¶rbÃ¤ttringar och nya funktioner. Vi kommer ocksÃ¥ att lansera ett helt nytt innehÃ¥ll som blir tillgÃ¤ngligt fÃ¶r dig sÃ¥ att du kan lÃ¤ra dig Ã¤nnu mer. Missa det inte. Vi ses snart!';
  }
  //Danish     
  else if ($language === 'da') {
  	$langError = 'ELX er lige nu under opdatering. Kom venligst tilbage d. 10/10/2016 for at opleve nogle spÃ¦ndende systemforbedringer og nye funktioner. Der vil ogsÃ¥ vÃ¦re helt nyt indhold tilgÃ¦ngeligt sÃ¥ du kan lÃ¦re endnu mere. GÃ¥ ikke glip af det. Vi ses snart!';
  }
  //Arabic     
  else if ($language === 'ar') {
  	$langError = 'ELX Ø­Ø§Ù„ÙŠØ§ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ùˆ Ø¥Ø¯Ø§Ø¡ Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø§Ù„ØªØ­Ø³ÙŠÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙÙŠ 10/10/2016 Ù„ØªØ¬Ø±Ø¨Ø© Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ù†Ø¸Ø§Ù… Ùˆ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©. Ø³ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙ†Ø§ Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­ Ù„Ùƒ Ù„Ù„ØªØ¹Ù„Ù… Ø§ÙŠØ¶Ø§Ù‹. Ù„Ø§ ØªÙÙˆØª Ø§Ù„ÙØ±ØµØ©. Ø³ÙˆÙ Ù†Ø±Ø§Ùƒ Ù‚Ø±ÙŠØ¨Ø§!';
  }
  //Italian     
  else if ($language === 'it') {
  	$langError = 'ELX Ã¨ in fase di aggiornamento. Ritorna su ELX il 10/10/2016 per scoprire miglioramenti e nuove funzionalitÃ . Ci saranno anche nuovi contenuti e aggiornamenti. Non mancare ti aspettiamo presto su ELX!';
  }
  //Hebrew
  else if ($language === 'he') {
    $langError = 'ELX ××™× ×• ×¤×¢×™×œ ×›×¢×ª ×‘×©×œ ×‘×™×¦×•×¢ ×¡×“×¨×ª ×©×“×¨×•×’×™× ×‘××ª×¨. ×× × ×—×–×¨×• ××œ×™× ×• ×‘×ª××¨×™×š 10/10/2016 ×›×“×™ ×œ×”×ª× ×¡×•×ª ×‘××¢×¨×›×ª ××©×•×¤×¨×ª, ×××¤×™×™× ×™× ×—×“×©×™× ×•×ª×•×›×Ÿ ×œ×™××•×“×™ ×—×“×©. ××œ ×ª×¤×¡×¤×¡×•. × ×ª×¨××” ×‘×§×¨×•×‘!';
  }
  //Greek     
  else if ($language === 'el') {
  	$langError = "Î¤Î¿ Î•LX Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Ï…Ï€ÏŒ ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ·, ÎºÎ±Î¸ÏÏ‚ Î´Î¹ÎµÎ½ÎµÏÎ³Î¿ÏÎ½Ï„Î±Î¹ ÎµÏÎ³Î±ÏƒÎ¯ÎµÏ‚ Î±Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±.\n\nÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î±Î½Î­Î»Î¸ÎµÏ„Îµ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÏƒÏ„Î¹Ï‚ 10/10/2016 Î³Î¹Î± Î½Î± Î¶Î®ÏƒÎµÏ„Îµ Ï„Î· ÏƒÏ…Î½Î±ÏÏ€Î±ÏƒÏ„Î¹ÎºÎ® ÎµÎ¼Ï€ÎµÎ¹ÏÎ¯Î± Ï„Î·Ï‚ ÎµÎ¾Î­Î»Î¹Î¾Î·Ï‚ Ï„Î¿Ï… ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚, Î¼Îµ Ï„Î± Î½Î­Î± Ï„Î¿Ï… Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬. Î•Ï€Î¯ÏƒÎ·Ï‚ Î¸Î± Î­Ï‡Î¿Ï…Î¼Îµ ÏƒÏ„Î· Î´Î¹Î¬Î¸ÎµÏƒÎ® ÏƒÎ±Ï‚ Î½Î­ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÎºÎ±Î¹ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î± Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÏÏÎ½ÎµÏ„Îµ Ï„Î¹Ï‚ Î³Î½ÏÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚. ÎœÎ·Î½ Î¾ÎµÏ‡Î¬ÏƒÎµÏ„Îµ Î½Î± Î¼Î±Ï‚ ÎµÏ€Î¹ÏƒÎºÎµÏ†Î¸ÎµÎ¯Ï„Îµ. Î˜Î± ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÏƒÏÎ½Ï„Î¿Î¼Î± ÎºÎ¿Î½Ï„Î¬ ÏƒÎ±Ï‚ !";
  }
  //German     
  else if ($language === 'de') {
  	$langError = "ELX wird momentan fÃ¼r Euch bearbeitet. \nAb 10.10.2016 begrÃ¼ÃŸen wir Euch wieder mit viel Neuem! Lasst Euch Ã¼berraschen und freut Euch auf die attraktiven Inhalte. \nBitte notiert Euch im Kalender, dass Ihr Euch am 15.09. wieder einloggt.  Bis dahin!";
  }
  //Czech     
  else if ($language === 'cs') {
  	$langError = 'ELX je v souÄasnÃ© dobÄ› v reÅ¾imu ÃºdrÅ¾by. ProvÃ¡dÃ­me aktualizaci. ProsÃ­m vraÅ¥te se na strÃ¡nky 10.10. 2016 a objevujte mnoho novÃ½ch vylepÅ¡enÃ­ a funkcÃ­. TÄ›Å¡it se mÅ¯Å¾ete i na novÃ½ obsah. Nenechte se to ujÃ­t. Brzy na shledanou!';
  }
  //Dutch     
  else if ($language === 'nl') {
  	$langError = 'Wegens onderhoudswerkzaamheden is de ELX-website tijdelijk niet beschikbaar. We verwelkomen je graag terug op 10 october 2016 met enkele systeemverbeteringen en nieuwe toepassingen. Je zal ook nieuwe inhoud kunnen ontdekken die je niet mag missen. Graag tot snel!';
  }
  //Thai     
  else if ($language === 'th') {
  	$langError = "à¸‚à¸“à¸°à¸™à¸µà¹‰ ELX à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡ à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¸´à¹ˆà¸¡à¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹ƒà¸™à¹€à¸§à¹Šà¸›à¹„à¸‹à¸”à¹Œà¹ƒà¸«à¹‰à¸”à¸µà¸¢à¸´à¹ˆà¸‡à¸‚à¸¶à¹‰à¸™ à¸ˆà¸¶à¸‡à¸‚à¸­à¹ƒà¸«à¹‰à¸„à¸¸à¸“à¸à¸¥à¸±à¸šà¸¡à¸²à¹€à¸‚à¹‰à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡à¹ƒà¸™ à¸§à¸±à¸™à¸—à¸µà¹ˆ 10 à¸•à¸¸à¸¥à¸²à¸„à¸¡ 2016 à¹€à¸›à¹‡à¸™à¸•à¹‰à¸™à¹„à¸›\": \"à¸‹à¸¶à¹ˆà¸‡à¸„à¸¸à¸“à¸ˆà¸°à¹„à¸”à¹‰à¸ªà¸±à¸¡à¸œà¸±à¸ªà¸£à¸°à¸šà¸šà¹ƒà¸«à¸¡à¹ˆà¹à¸¥à¸°à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸”à¸µà¸¢à¸´à¹ˆà¸‡à¸‚à¸¶à¹‰à¸™ à¹à¸¥à¸°à¹€à¸£à¸²à¸à¹‡à¹„à¸”à¹‰à¸ˆà¸±à¸”à¹€à¸•à¸£à¸µà¸¢à¸¡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸§à¹ƒà¸«à¸¡à¹ˆà¹†à¸—à¸µà¹ˆà¸£à¸­à¹ƒà¸«à¹‰à¸„à¸¸à¸“à¸„à¹‰à¸™à¸„à¸§à¹‰à¸²à¹à¸¥à¸°à¹„à¸¡à¹ˆà¸„à¸§à¸£à¸à¸¥à¸²à¸” à¹à¸¥à¹‰à¸§à¸à¸šà¸à¸±à¸™à¹ƒà¸™à¹€à¸£à¹‡à¸§à¹†à¸™à¸µà¹‰ !";
  } 
  //Korean     
  else if ($language === 'ko') {
  	$langError = "í˜„ì¬, ELX ì‚¬ì´íŠ¸ëŠ” ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ë¡œ ì¸í•´ ì ‘ì†ì´ ì œí•œë©ë‹ˆë‹¤. \nìƒˆë¡œìš´ ì»¨í…ì¸ ì™€ ìµœì‹  ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œëœ ELX ì‚¬ì´íŠ¸ë¥¼2016ë…„ 10ì›” 10ì¼ë¶€í„° ê²½í—˜í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.";
  }
  //Japanese     
  else if ($language === 'ja') {
  	$langError = "ELXã¯ç¾åœ¨ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å‘ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã§ã™ã€‚\n2016å¹´10æœˆ10æ—¥ã«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ãŒæ›´æ–°ã•ã‚Œã¦ã€æ–°ã—ã„ã‚µã‚¤ãƒˆã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚\næ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚‚ãƒ­ãƒ³ãƒã•ã‚Œã‚‹äºˆå®šã§ã™ã®ã§ã€æ¥½ã—ã¿ã«ãŠå¾…ã¡ãã ã•ã„ã€‚";
  }
  //Indonesian     
  else if ($language === 'id') {
  	$langError = 'Saat ini ELX masih dalam tahap perbaikan untuk menjalankan beberapa peningkatan pada situs. Harap kembali pada 10/10/2016 (mm/dd/yyyy) untuk mencoba fitur-fitur baru dan beberapa perbaikan sistem yang menarik. Kami juga memiliki konten baru yang bisa Anda pelajari. Jangan lewatkan. Sampai jumpa!';
  }
  //Simplified Chinese     
  else if ($language === 'zh-Hans') {
  	$langError = "ELXç›®å‰å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œæ­£åœ¨è¿›è¡Œä¸€ç³»åˆ—çš„ç½‘ç«™å‡çº§ã€‚2016å¹´10æœˆ10æ—¥é‡æ–°å¼€æ”¾ï¼Œæ¬¢è¿å±Šæ—¶ä½“éªŒä»¤äººå…´å¥‹çš„ç³»ç»Ÿä¼˜åŒ–å’Œå…¨æ–°çš„åŠŸèƒ½ã€‚\næˆ‘ä»¬åŒæ—¶ä¹Ÿå°†æä¾›å…¨æ–°çš„å­¦ä¹ å†…å®¹ï¼Œç²¾å½©å†…å®¹å³å°†å¼€å¯ï¼Œä¸å®¹é”™è¿‡ï¼";
  }
  //Traditional Chinese     
  else if ($language === 'zh-Hant') {
  	$langError = 'ELXç¶²ç«™ç¾æ­£æ›´æ–°ä¸­ï¼Œè«‹æ–¼ 10/10/2016 å¾Œå†æ¬¡é€ è¨ªã€‚æ•¬è«‹æœŸå¾…æˆ‘å€‘ç‚ºæ‚¨æº–å‚™çš„å…¨æ–°å­¸ç¿’å…§å®¹ï¼Œæˆ‘å€‘å¾ˆå¿«å†è¦‹ï¼';
  }
  //French
  else if ($language === 'fr') {
    $langError = 'Le site ELX est en cours de maintenance. Merci de vous reconnecter le 10/10/2016 afin de dÃ©couvrir les nouvelles fonctionnalitÃ©s de votre site dâ€™apprentissage EstÃ©e Lauder.  Vous y dÃ©couvrirez Ã©galement beaucoup de nouveautÃ©s Ã  ne pas manquer ! A trÃ¨s bientÃ´t !';
  }
  //French(Canada)
  else if ($language === 'fr-CA') {
  	$langError = "ELX est prÃ©sentement en entretien et effectue des mises Ã  niveau pour l'amÃ©lioration de ce site. Sâ€™il-vous-plaÃ®t, revenez nous visiter le 10/10/2016 (mm/jj/aaaa) et expÃ©rimentez un systÃ¨me perfectionnÃ© ainsi que de nouvelles fonctionnalitÃ©s. Nous aurons Ã©galement du nouveau contenu Ã  votre disposition. Ne manquez rien. Nous vous reverrons bientÃ´t!";
  }
  //Default to English
  else {
    $langError = 'ELX is currently in maintenance mode, performing a series of upgrades for the site.  Please come back on 10/10/2016 to experience some exciting system improvements and new features. We will also have new content available for you to learn. Donâ€™t miss out. We will see you soon!';
  }
  return $langError;
}

/**
 * Helper function that checks if logged in user belongs to the mentioned markets
 * Returns FALSE if user belongs to atleast one of the markets mentioned in the function; TRUE otherwise
 */
function _userNotBelongsToSpecificMarkets()
{
	//Load the markets - Fashion Group,South Africa,U.K.,Singapore,Canada,New Zealand,Australia,United States in that order
	$markets = array(34466,34476,34489,34498,34506,34518,34519,34520);
	$isMember = false; //Flag to check if user belongs to any of the above markets
	foreach($markets as $market)
	{
		if(og_is_member('node', $market, 'user'))
		{
			$isMember = true;
			break;
		}
	}
	return !$isMember;
}

/**
 * Implements hook_menu_link_alter()
 * Borrowed from https://api.drupal.org/comment/45108#comment-45108
 */
function elx_utility_menu_link_alter(&$item)
{
	if($item['link_path']=="user" && user_is_anonymous()) //If the path is '/user' but user is not logged in, redirect to user/login
	{
		$item['link_path'] = 'user/login';
	}
}